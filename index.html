<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>COPAIBA @ Editor de oto.ini</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Encoding.js para Shift-JIS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/1.0.30/encoding.min.js" defer></script>

  <!-- Estilos customizados -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body class="theme-light">
  <!-- Header -->
  <header class="sticky top-0 z-10 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <h1 class="text-2xl font-semibold">COPAIBA @ Editor de oto.ini</h1>

      <div class="flex items-center gap-2 ml-auto">
        <input id="pickFolder" type="file" webkitdirectory directory multiple accept="audio/wav" class="hidden" />
        <input id="pickOto" type="file" accept=".ini,.txt" class="hidden" />

        <select id="otoEncoding" class="px-2 py-1 rounded-lg border bg-transparent text-xs">
          <option value="auto" selected>Detec√ß√£o autom√°tica</option>
          <option value="utf-8">UTF-8 (OpenUTAU)</option>
          <option value="shift_jis">ANSI JP (Shift_JIS / UTAU legado)</option>
          <option value="windows-1252">ANSI Latin-1 (pt-BR)</option>
          <option value="utf-16le">Unicode (UTF-16 LE)</option>
        </select>

        <span id="encodingBadge" class="tag text-[10px]" title="Codifica√ß√£o usada ao ler o oto.ini">UTF-8 (auto)</span>

        <button id="btnFolder" class="px-3 py-1.5 rounded-xl border bg-transparent hover:bg-black/5">Abrir pasta
          .wav</button>
        <button id="btnOto" class="px-3 py-1.5 rounded-xl border bg-transparent hover:bg-black/5">Carregar
          oto.ini</button>
        <button id="btnSave" class="px-3 py-1.5 rounded-xl border bg-transparent hover:bg-black/5 disabled:opacity-50"
          disabled>Exportar oto.ini</button>
        <button id="btnSaveOverwrite"
          class="px-3 py-1.5 rounded-xl border bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 hidden"
          disabled title="Salvar diretamente no arquivo oto.ini original">üíæ Salvar/Sobrepor</button>

        <button id="btnTheme" class="px-3 py-1.5 rounded-xl border bg-transparent hover:bg-black/5 text-sm"
          title="Alternar modo claro/escuro">üåô</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
    <div class="grid grid-cols-12 gap-4">
      <!-- LEFT PANEL - Arquivos e aliases -->
      <aside class="col-span-12 md:col-span-4">
        <div id="pane-files" class="card floatable" data-float-key="files">
          <div class="card-header drag-handle">
            <div class="flex items-center gap-2">
              <span class="text-sm">Arquivos e aliases</span>
              <span id="countAliases" class="tag">0</span>
              <span id="countStars" class="tag" title="Itens marcados (‚òÖ)">‚òÖ 0</span>
            </div>
            <div class="flex items-center gap-2">
              <button class="float-btn" data-minimize title="Minimizar">_</button>
              <button class="float-btn" data-float-toggle title="Destacar/Voltar">üóñ</button>
            </div>
          </div>

          <div class="card-body p-3 space-y-2">
            <div class="space-y-2">
              <div class="flex items-center gap-2">
                <input id="filter" placeholder='Filtrar‚Ä¶ (ex.: b ou "b r")'
                  class="w-full px-2 py-1 rounded-lg border bg-transparent text-sm" />
              </div>
              <div class="flex items-center gap-3 text-xs text-muted">
                <label class="flex items-center gap-1">
                  <input id="filterRegex" type="checkbox" class="accent-blue-500"> Regex
                </label>
                <label class="flex items-center gap-1">
                  <input id="filterStarred" type="checkbox" class="accent-blue-500"> Somente ‚òÖ
                </label>
                <button id="btnSelectResults" class="px-2 py-1 rounded-lg border bg-transparent">Selecionar
                  resultados</button>
                <button id="btnClearSelection" class="px-2 py-1 rounded-lg border bg-transparent">Limpar
                  sele√ß√£o</button>
                <button id="btnStarResults" class="px-2 py-1 rounded-lg border bg-transparent"
                  title="Marca/Desmarca ‚òÖ dos resultados atuais">‚òÖ/‚òÜ resultados</button>
              </div>
              <p class="text-xs text-muted">
                Ctrl+Clique = selecionar individual ‚Ä¢ Shift+Clique = intervalo
              </p>
            </div>

            <div id="aliasList" class="max-h-[60vh] overflow-auto divide-y divide-slate-200/40"></div>
          </div>
        </div>
      </aside>

      <!-- RIGHT PANEL - Waveform, Grid, etc -->
      <section class="col-span-12 md:col-span-8 space-y-3">
        <!-- WAVE -->
        <div id="pane-wave" class="card floatable" data-float-key="wave">
          <div class="card-header drag-handle">
            <div class="text-sm">
              <span id="currentName" class="font-medium">(nenhum arquivo)</span>
              <span id="srInfo" class="ml-2 text-muted text-xs"></span>
            </div>
            <div class="flex items-center gap-2 text-xs text-muted">
              <div class="hidden sm:flex items-center gap-2">
                <button id="btnPlay" class="px-2 py-1 rounded-lg border bg-transparent">‚ñ∂Ô∏è Tocar/Pausar</button>
              </div>
              <div class="flex items-center gap-2">
                <input id="zoom" type="range" min="1" max="128" step="1" value="1" />
                <span id="zoomLabel">1√ó</span>
                <span>H-Zoom (Ctrl+Roda)</span>
              </div>
              <div class="flex items-center gap-2">
                <input id="vzoom" type="range" min="0.25" max="4" step="0.05" value="1" />
                <span id="vzoomLabel">1.00√ó</span>
                <span>V-Zoom (Alt+Roda)</span>
              </div>
              <label class="flex items-center gap-1">
                <input id="toggleSpec" type="checkbox" class="accent-blue-500"> Espectrograma
              </label>
              <div class="flex items-center gap-1">
                <span>Cor</span>
                <input id="waveColorPicker" type="color" class="w-7 h-7 border rounded" />
              </div>
              <div class="flex items-center gap-1">
                <span>Fundo</span>
                <input id="waveBgColorPicker" type="color" class="w-7 h-7 border rounded" />
              </div>
              <button class="float-btn" data-minimize title="Minimizar">_</button>
              <button class="float-btn" data-float-toggle title="Destacar/Voltar">üóñ</button>
            </div>
          </div>
          <div class="card-body">
            <div class="relative">
              <canvas id="wave" height="260"></canvas>
              <div id="labels"></div>
            </div>
            <div class="border-t" style="border-color:var(--border);">
              <div class="px-3 py-2">
                <canvas id="mini" height="60"></canvas>
              </div>
            </div>

            <div id="specWrap" class="mt-2 hidden">
              <canvas id="spec" height="180"></canvas>
              <div class="text-xs text-muted px-2 pt-1">
                Espectrograma: janela 512 ‚Ä¢ hop 256 ‚Ä¢ Hann ‚Ä¢ dB normalizado (pr√©-calculado)
              </div>
            </div>

            <div class="px-3 pb-2 text-xs text-muted">
              Q/W/E/R/T = marcar ‚Ä¢ Y = tocar/pausar ‚Ä¢ Shift+0 = duplicar ‚Ä¢ Shift+9 = renomear ‚Ä¢
              S = alternar ‚òÖ ‚Ä¢ ‚Üë/‚Üì ou Scroll = navegar ‚Ä¢ Ctrl+Roda = H-Zoom ‚Ä¢ Shift+Roda = rolar ‚Ä¢ Alt+Roda = V-Zoom
            </div>
          </div>
        </div>

        <!-- PLANILHA -->
        <div id="pane-grid" class="card floatable" data-float-key="grid">
          <div class="card-header drag-handle">
            <div class="flex items-center gap-2">
              <span class="text-sm">Planilha de par√¢metros</span>
              <span class="tag text-[10px] text-muted">Ctrl+Clique / Shift+Clique = sele√ß√£o</span>
            </div>
            <div class="flex items-center gap-2">
              <button class="float-btn" data-minimize title="Minimizar">_</button>
              <button class="float-btn" data-float-toggle title="Destacar/Voltar">üóñ</button>
            </div>
          </div>
          <div class="card-body p-2">
            <div class="overflow-auto max-h-[50vh]">
              <table class="w-full text-xs table-fixed border-collapse">
                <thead class="grid-header">
                  <tr>
                    <th class="text-left px-2 py-1 border-b border-slate-200/60 w-[38%]">.wav</th>
                    <th class="text-right px-2 py-1 border-b border-slate-200/60 w-[9%]">Corte inicial</th>
                    <th class="text-right px-2 py-1 border-b border-slate-200/60 w-[9%]">Transi√ß√£o</th>
                    <th class="text-right px-2 py-1 border-b border-slate-200/60 w-[9%]">In√≠cio da vogal</th>
                    <th class="text-right px-2 py-1 border-b border-slate-200/60 w-[9%]">Parte de loop</th>
                    <th class="text-right px-2 py-1 border-b border-slate-200/60 w-[9%]">Corte final</th>
                    <th class="text-left px-2 py-1 border-b border-slate-200/60 w-[17%]">Alias</th>
                  </tr>
                </thead>
                <tbody id="gridBody"></tbody>
              </table>
            </div>
            <p class="mt-2 text-[11px] text-muted">
              Sele√ß√£o em ret√¢ngulo com Shift+Clique. Ao editar uma c√©lula, o valor √© aplicado a todas as c√©lulas
              selecionadas da mesma coluna.
              Ctrl+C / Ctrl+V funcionam para copiar/colar blocos como no SetParam.
            </p>
          </div>
        </div>

        <!-- PAR√ÇMETROS DETALHADOS + PRESETS -->
        <div id="pane-params" class="card floatable" data-float-key="params">
          <div class="card-header drag-handle">
            <span class="text-sm">Configura√ß√µes dos par√¢metros</span>
            <div class="flex items-center gap-2">
              <button class="float-btn" data-minimize title="Minimizar">_</button>
              <button class="float-btn" data-float-toggle title="Destacar/Voltar">üóñ</button>
            </div>
          </div>
          <div class="card-body p-3 space-y-4">
            <!-- Campos principais -->
            <div class="grid grid-cols-12 gap-3 items-end">
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">Alias/Fonema/Legenda</label>
                <input id="alias" class="w-full px-2 py-2 rounded-lg border bg-transparent" placeholder="alias" />
              </div>
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">Corte inicial (Q)</label>
                <input id="offset" type="number" class="w-full px-2 py-2 rounded-lg border bg-transparent" step="1" />
              </div>
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">Transi√ß√£o (W)</label>
                <input id="overlap" type="number" class="w-full px-2 py-2 rounded-lg border bg-transparent" step="1" />
              </div>
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">In√≠cio da vogal (E)</label>
                <input id="preutter" type="number" class="w-full px-2 py-2 rounded-lg border bg-transparent" step="1" />
              </div>
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">Parte de loop (R)</label>
                <input id="consonant" type="number" class="w-full px-2 py-2 rounded-lg border bg-transparent"
                  step="1" />
              </div>
              <div class="col-span-6 md:col-span-2">
                <label class="text-xs text-muted">Corte final (T)</label>
                <input id="cutoff" type="number" class="w-full px-2 py-2 rounded-lg border bg-transparent" step="1" />
              </div>
            </div>

            <!-- PRESETS R√ÅPIDOS -->
            <div class="border-t pt-3" style="border-color:var(--border);">
              <div class="flex items-center justify-between mb-2 gap-2">
                <h3 class="text-xs font-semibold text-muted">Presets r√°pidos (edi√ß√£o em lote)</h3>
                <span class="text-[11px] text-muted">
                  Aplicado nas linhas selecionadas (planilha ou lista). Valores salvos entre sess√µes.
                </span>
              </div>

              <div class="grid grid-cols-12 gap-3 items-end text-xs">
                <div class="col-span-6 md:col-span-3">
                  <label class="flex items-center gap-1 text-[11px] text-muted mb-1">
                    <input id="presetUseOverlap" type="checkbox" class="accent-blue-500" checked>
                    Usar Overlap
                  </label>
                  <input id="presetOverlap" type="number" class="w-full px-2 py-1.5 rounded-lg border bg-transparent"
                    step="1" />
                </div>
                <div class="col-span-6 md:col-span-3">
                  <label class="flex items-center gap-1 text-[11px] text-muted mb-1">
                    <input id="presetUsePreutter" type="checkbox" class="accent-blue-500" checked>
                    Usar Preutter
                  </label>
                  <input id="presetPreutter" type="number" class="w-full px-2 py-1.5 rounded-lg border bg-transparent"
                    step="1" />
                </div>
                <div class="col-span-6 md:col-span-3">
                  <label class="flex items-center gap-1 text-[11px] text-muted mb-1">
                    <input id="presetUseConsonant" type="checkbox" class="accent-blue-500" checked>
                    Usar Consonant
                  </label>
                  <input id="presetConsonant" type="number" class="w-full px-2 py-1.5 rounded-lg border bg-transparent"
                    step="1" />
                </div>
                <div class="col-span-6 md:col-span-3">
                  <label class="flex items-center gap-1 text-[11px] text-muted mb-1">
                    <input id="presetUseCutoff" type="checkbox" class="accent-blue-500" checked>
                    Usar Cutoff
                  </label>
                  <input id="presetCutoff" type="number" class="w-full px-2 py-1.5 rounded-lg border bg-transparent"
                    step="1" />
                </div>
              </div>

              <div class="mt-3 flex flex-wrap items-center gap-2">
                <button id="btnApplyPreset"
                  class="px-3 py-1.5 rounded-lg border bg-transparent hover:bg-black/5 text-xs">
                  Aplicar preset nos selecionados
                </button>
                <span class="text-[11px] text-muted">
                  Se houver sele√ß√£o na planilha, o preset respeita essa sele√ß√£o. Caso contr√°rio, usa os aliases
                  selecionados na lista (ou apenas o atual).
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- OTO RAW -->
        <div id="pane-oto" class="card floatable" data-float-key="oto">
          <div class="card-header drag-handle">
            <div class="flex items-center gap-2">
              <span class="text-sm">oto.ini (edit√°vel)</span>
              <span id="countLines" class="tag">0</span>
            </div>
            <div class="flex items-center gap-2">
              <button class="float-btn" data-minimize title="Minimizar">_</button>
              <button class="float-btn" data-float-toggle title="Destacar/Voltar">üóñ</button>
            </div>
          </div>
          <div class="card-body p-3">
            <textarea id="otoView" class="w-full h-60 p-2 rounded-lg border bg-transparent text-xs leading-5"
              spellcheck="false"></textarea>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Dock para pain√©is minimizados -->
  <div id="dock" class="hidden"></div>

  <!-- JavaScript Modules -->
  <script type="module" src="js/main.js"></script>
</body>

</html>